<html>
<head>
<title>Cat Clicker ver.3</title>
</head>
<body>
<h1 id="cats">Cat Clicker ver.3</h1>
<p>
Here are 6 groups of cats, select and click as you like.
</p>
<select id="cat_select">
</select>
<hr>
<small><pre>
This is a toy application from Udacity MOOC &ldquo;JavaScript Design Patterns&rdquo;.

https://www.udacity.com/course/javascript-design-patterns--ud989
</pre>
<script>
(function(document) {
  'use strict';
  var cat_array = [{name: "Nyan", image:"cat.jpg"},
                  {name: "Mya", image:"cat2.jpg"},
                  {name: "NyanNyan", image:"cat3.jpg"},
                  {name: "Mia", image:"cat4.jpg"},
                  {name: "NyanNyanNyan", image:"cat5.jpg"},
                  {name: "Nyaaaa", image:"cat6.jpg"},
                  ];

  var currentElement = document.getElementById('cat_select');

  function insertAfter(newNode, existingNode) {
    existingNode.parentNode.insertBefore(newNode, existingNode.nextSibling);
  }

  function findCat(cat_name) {
      var found_cat = cat_array.filter(function(cat_dict) {
          if (cat_dict['name'] == cat_name) {
              return cat_dict
          }
      });
      console.log(found_cat);
      return found_cat[0];
  }

  function addSelection() {
    var cat_select = document.getElementById('cat_select');
    cat_array.map(function(cat_dict) {
       var option  = document.createElement('option');
       option.text = cat_dict['name'];
       option.value = cat_dict['name']
       cat_select.add(option);
    });
    cat_select.addEventListener('change', function() {
       var selected_value = this.value
       console.log('selected:' + selected_value);
       if (document.getElementById(selected_value) == null) {
          var cat = findCat(selected_value);
          console.log(cat['image']);
          addCat(cat['name'], cat['image'], this.value);
       }
       document.getElementById(selected_value).style.display  = "block";
       cat_array.map(function(cat_dict) {
         if (cat_dict['name'] != selected_value) {
           var unselected = document.getElementById(cat_dict['name']);
           if (unselected !== null) {
               unselected.style.display  = "none";
           }
         }
       });
    });

  }
  function addCat(cat_name, img_src, cat_id) {
    var cat_div = document.createElement('div')
    var h2_title = document.createElement('h2');
    h2_title.textContent = cat_name;
    var cat_img = document.createElement('img');
    var counter = document.createElement('h3');
    counter.textContent = 0;
    var count = 0;
    cat_div.id = cat_id
    cat_img.src = img_src;
    cat_img.addEventListener('click', function() {
      count = count + 1;
      counter.textContent = count;
    }, false);
    cat_div.appendChild(h2_title);
    cat_div.appendChild(cat_img);
    cat_div.appendChild(counter);
    insertAfter(cat_div, currentElement);
    currentElement = cat_div;
  }
  addSelection();
  addCat(cat_array[0].name, cat_array[0].image, cat_array[0].name);
  /*
  document.addEventListener('DOMContentLoaded', function() {
    currentElement.selectedIndex = 1; 
  }, false);
  */
})(document);
</script>
</small>
</body>
</html>
